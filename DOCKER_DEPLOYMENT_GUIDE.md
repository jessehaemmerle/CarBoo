# Fleet Management System - Docker Deployment Guide

## Overview

The Fleet Management System is now properly configured for Docker deployment with the frontend exposed on **Port 80** (standard HTTP port).

## ‚úÖ Fixed Issues

The following configuration issues have been corrected:

### 1. Port Configuration ‚úÖ
- **Frontend Port**: Now properly configured to expose on port 80 for production
- **Environment Variables**: `FRONTEND_HOST_PORT=80` properly set in `.env`
- **Docker Compose**: Production and development modes both support configurable ports

### 2. Environment Configuration ‚úÖ
- **Frontend .env**: `REACT_APP_BACKEND_URL` now points to `http://localhost:8001`
- **Backend .env**: Database name consistency fixed (`fleetmanager`)
- **Root .env**: All required variables properly configured

### 3. Database Configuration ‚úÖ
- **MongoDB Health Checks**: Added proper health checks to both production and development
- **Database Name**: Consistent `fleetmanager` database across all environments
- **Connection URLs**: Properly configured for Docker networking

### 4. Health Checks ‚úÖ
- **Backend**: `/api/health` endpoint verified and working
- **Frontend**: Health check endpoint created at `/health`
- **MongoDB**: Proper health checks added to Docker compose files

## üöÄ Deployment Commands

### Automatic Docker Installation
If Docker is not installed, the system will offer automatic installation:

```bash
# The docker-start.sh script will automatically detect missing Docker
# and offer installation options:
./docker-start.sh docker-prod
```

**Manual Docker Installation Options:**
```bash
# Quick installation (Ubuntu/Debian)
./quick-install-docker.sh

# Full installation (all Linux distributions)
./install-docker.sh

# Remove Docker installation
./install-docker.sh remove

# Verify Docker installation
./install-docker.sh verify
```

### Production Deployment (Port 80)
```bash
# Deploy with frontend on port 80
./docker-start.sh docker-prod
```

### Development Deployment (Port 3000)
```bash
# Deploy development environment with hot reload
./docker-start.sh docker-dev
```

### Switch Back to Supervisor Mode
```bash
# Return to supervisor-based deployment
./docker-start.sh supervisor
```

## üìã Available Commands

| Command | Description |
|---------|-------------|
| `./docker-start.sh docker-prod` | Start production Docker environment (Port 80) |
| `./docker-start.sh docker-dev` | Start development Docker environment (Port 3000) |
| `./docker-start.sh supervisor` | Switch back to supervisor mode |
| `./docker-start.sh status` | Show current service status |
| `./docker-start.sh logs` | View Docker container logs |
| `./docker-start.sh clean` | Clean up Docker containers and volumes |
| `./validate-docker-config.sh` | Validate Docker configuration |

## üîç Service Configuration

### Production Mode
- **Frontend**: http://localhost:80 (or just http://localhost)
- **Backend API**: http://localhost:8001
- **API Documentation**: http://localhost:8001/docs
- **MongoDB**: Internal Docker networking (port 27017)

### Development Mode
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8001
- **API Documentation**: http://localhost:8001/docs
- **MongoDB**: Internal Docker networking (port 27017)

## üõ†Ô∏è Configuration Files

### Root Configuration
- **`.env`**: Main environment configuration with database credentials and port settings
- **`docker-compose.yml`**: Production Docker configuration
- **`docker-compose.dev.yml`**: Development Docker configuration

### Service-Specific Configuration
- **`frontend/.env`**: Frontend environment variables (backend URL)
- **`backend/.env`**: Backend environment variables (database connection)

## üè• Health Checks

All services include proper health checks:

- **MongoDB**: `mongosh --eval "db.adminCommand('ping')"`
- **Backend**: `GET /api/health` - Tests database connectivity
- **Frontend**: `GET /health` - Basic availability check

## üîê Security

- **Database Passwords**: Automatically generated secure passwords
- **JWT Secrets**: Secure random JWT signing keys
- **Container Security**: Non-root containers in production mode
- **Network Isolation**: Services communicate via isolated Docker networks

## üìù Environment Variables

### Required Variables (automatically configured)
```bash
# Database
MONGO_PASSWORD=<auto-generated>
DB_NAME=fleetmanager

# Security
JWT_SECRET=<auto-generated>

# Service URLs
BACKEND_URL=http://localhost:8001
REACT_APP_BACKEND_URL=http://localhost:8001

# Port Configuration
FRONTEND_HOST_PORT=80
```

## üß™ Testing Configuration

Run the configuration validator to ensure everything is properly set up:

```bash
./validate-docker-config.sh
```

This will test:
- All Docker configuration files exist
- Environment variables are properly configured
- Health check endpoints are available
- Port mappings are correct
- Database configuration is consistent

## üö¢ Server Deployment

### Prerequisites
On your server, ensure you have:
- Linux system (Ubuntu/Debian, CentOS/RHEL, Fedora, Amazon Linux)
- Sufficient ports available (80, 8001, 27017)
- **Docker Installation**: Use our automated scripts if needed

### Automated Docker Installation
```bash
# Quick installation (Ubuntu/Debian only)
./quick-install-docker.sh

# Full installation (supports all Linux distributions)
./install-docker.sh

# The docker-start.sh script will also offer automatic installation
./docker-start.sh docker-prod
```

### Deployment Steps
1. **Clone/Upload your repository** to the server
2. **Install Docker** (if not already installed):
   ```bash
   ./quick-install-docker.sh
   ```
3. **Run the production setup**:
   ```bash
   ./docker-start.sh docker-prod
   ```
4. **Verify deployment**:
   ```bash
   ./docker-start.sh status
   ```
5. **Access your application** at `http://your-server-ip` (port 80)

### Port 80 Access
The frontend is now properly configured to run on port 80, which means:
- Users can access your app at `http://your-server-ip` (without specifying a port)
- Standard HTTP traffic will work correctly
- You can easily set up SSL/HTTPS later with a reverse proxy

## üîß Troubleshooting

### If services don't start:
```bash
# Check logs
./docker-start.sh logs

# Check status
./docker-start.sh status

# Validate configuration
./validate-docker-config.sh
```

### If you need to reset:
```bash
# Clean everything and start fresh
./docker-start.sh clean
./docker-start.sh docker-prod
```

### Database Issues:
- MongoDB data is persisted in Docker volumes
- Database credentials are in the `.env` file
- Health checks ensure proper database connectivity

## ‚úÖ Verification Checklist

After deployment, verify:
- [ ] Frontend accessible at http://localhost (port 80)
- [ ] Backend API accessible at http://localhost:8001
- [ ] API documentation at http://localhost:8001/docs
- [ ] All Docker containers are healthy
- [ ] Database connectivity working
- [ ] Authentication system functional

## üìû Support

If you encounter any issues:
1. Run `./validate-docker-config.sh` to check configuration
2. Check logs with `./docker-start.sh logs`
3. Verify service status with `./docker-start.sh status`

The system is now ready for deployment with proper Docker configuration and frontend exposed on port 80!