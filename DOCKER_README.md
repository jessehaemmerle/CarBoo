# 🐳 Docker Setup Guide - Fleet Management System

## Overview

Your Fleet Management System now supports both **Supervisor-based** and **Docker-based** deployment modes. You can easily switch between them based on your needs.

## 🚀 Quick Start

### Prerequisites

1. **Docker & Docker Compose** installed on your system
   - [Install Docker](https://docs.docker.com/get-docker/)
   - [Install Docker Compose](https://docs.docker.com/compose/install/)

2. **System Requirements**
   - 4GB+ RAM recommended
   - 2GB+ free disk space

### Switch to Docker Mode

```bash
# Start Docker development environment (with hot reload)
./docker-start.sh docker-dev

# Start Docker production environment (optimized)
./docker-start.sh docker-prod

# Switch back to supervisor mode
./docker-start.sh supervisor
```

## 📋 Available Commands

| Command | Description |
|---------|-------------|
| `./docker-start.sh docker-dev` | Start Docker development environment |
| `./docker-start.sh docker-prod` | Start Docker production environment |
| `./docker-start.sh supervisor` | Switch back to supervisor mode |
| `./docker-start.sh stop-docker` | Stop Docker services |
| `./docker-start.sh logs` | View Docker logs |
| `./docker-start.sh status` | Show all services status |
| `./docker-start.sh clean` | Clean Docker containers and volumes |
| `./docker-start.sh help` | Show help information |

## 🔄 Deployment Modes

### 1. Supervisor Mode (Default)
- **Current setup**: Services managed by supervisor
- **Best for**: Development on this platform
- **Ports**: Frontend :3000, Backend :8001
- **MongoDB**: localhost:27017

### 2. Docker Development Mode
- **Hot reload**: Code changes automatically refresh
- **Volume mounting**: Live code editing
- **Best for**: Local development with Docker
- **Isolation**: Services run in separate containers

### 3. Docker Production Mode
- **Optimized builds**: Multi-stage Docker builds
- **Security**: Non-root containers
- **Health checks**: Built-in monitoring
- **Best for**: Production deployment

## 🏗️ Architecture

### Docker Services

```yaml
Services:
├── mongodb      # MongoDB 7.0 database
├── backend      # FastAPI application  
├── frontend     # React application
└── nginx        # Reverse proxy (production)
```

### Port Mapping

| Service | Development | Production |
|---------|-------------|------------|
| Frontend | :3000 | :3000 (via nginx) |
| Backend | :8001 | :8001 (via nginx) |
| MongoDB | :27017 | Internal only |

## 🔧 Configuration

### Environment Variables

The Docker setup uses these key environment variables:

```env
# Database
MONGO_PASSWORD=<auto-generated>

# Security
JWT_SECRET=<auto-generated>

# URLs
BACKEND_URL=http://localhost:8001
REACT_APP_BACKEND_URL=http://localhost:8001
```

### Automatic Setup

- Environment file (`.env`) is created automatically
- Secure passwords are generated
- Database connections are configured
- All services are networked together

## 📊 Monitoring & Maintenance

### Check Service Status
```bash
./docker-start.sh status
```

### View Logs
```bash
./docker-start.sh logs
```

### Health Checks
All services include health checks:
- MongoDB: Connection test
- Backend: API endpoint check
- Frontend: HTTP response check

### Database Backup (Production)
```bash
./setup.sh backup
```

## 🔄 Switching Between Modes

### From Supervisor to Docker
```bash
# This automatically stops supervisor and starts Docker
./docker-start.sh docker-dev
```

### From Docker to Supervisor
```bash
# This stops Docker and restarts supervisor
./docker-start.sh supervisor
```

### Check Current Mode
```bash
./docker-start.sh status
```

## 🛠️ Development Workflow

### With Docker Development Mode

1. **Start development environment**:
   ```bash
   ./docker-start.sh docker-dev
   ```

2. **Make code changes** - they'll be reflected immediately due to volume mounting

3. **View logs** for debugging:
   ```bash
   ./docker-start.sh logs
   ```

4. **Access services**:
   - Frontend: http://localhost:3000
   - Backend API: http://localhost:8001
   - API Docs: http://localhost:8001/docs

## 🚀 Production Deployment

### With Docker Production Mode

1. **Configure environment** (optional):
   ```bash
   # Edit .env file if needed
   nano .env
   ```

2. **Start production environment**:
   ```bash
   ./docker-start.sh docker-prod
   ```

3. **Monitor services**:
   ```bash
   ./docker-start.sh status
   ./docker-start.sh logs
   ```

### External Deployment

Use the Docker Compose files on any server:

```bash
# On your server
git clone <your-repo>
cd fleet-management-system

# Start production environment
./docker-start.sh docker-prod
```

## 🔒 Security Features

### Production Docker Setup
- **Non-root containers**: Enhanced security
- **Health checks**: Automatic service monitoring
- **Resource limits**: Prevent resource exhaustion
- **Secure networking**: Isolated container network
- **Environment-based secrets**: Secure configuration

## 🐛 Troubleshooting

### Common Issues

1. **Port conflicts**:
   ```bash
   # Stop conflicting services
   ./docker-start.sh supervisor
   # Or change ports in docker-compose files
   ```

2. **Permission errors**:
   ```bash
   sudo chown -R $USER:$USER .
   ```

3. **Database connection issues**:
   ```bash
   # Check if MongoDB is running
   ./docker-start.sh status
   ```

4. **Clean start**:
   ```bash
   ./docker-start.sh clean
   ./docker-start.sh docker-dev
   ```

### Log Analysis
```bash
# View specific service logs
docker-compose logs backend
docker-compose logs frontend
docker-compose logs mongodb
```

## 📁 File Structure

```
/app/
├── docker-compose.yml          # Production Docker setup
├── docker-compose.dev.yml      # Development Docker setup
├── docker-start.sh            # Main Docker management script
├── setup.sh                   # Original setup script
├── .env.example              # Environment template
├── backend/
│   ├── Dockerfile            # Development backend image
│   ├── Dockerfile.prod       # Production backend image
│   └── requirements.txt      # Python dependencies
├── frontend/
│   ├── Dockerfile            # Development frontend image
│   ├── Dockerfile.prod       # Production frontend image
│   ├── nginx.conf            # Frontend nginx config
│   └── package.json          # Node.js dependencies
└── nginx/
    └── nginx.conf            # Production reverse proxy
```

## 🎯 Best Practices

### Development
- Use `docker-dev` mode for local development
- Keep supervisor mode for quick testing
- Use `./docker-start.sh logs` for debugging

### Production
- Use `docker-prod` mode for deployment
- Set up automated backups
- Monitor with `./docker-start.sh status`
- Keep `.env` file secure

## 🆘 Support

### Get Help
```bash
./docker-start.sh help
```

### Check System Status
```bash
./docker-start.sh status
```

### Reset Everything
```bash
./docker-start.sh clean
./docker-start.sh docker-dev
```

---

**🚗💨 Your Fleet Management System is now Docker-ready and can be deployed anywhere!**